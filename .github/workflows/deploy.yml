#!/bin/bash
set -e

cd ~/NextChat
git pull origin main

# Remove old containers
docker stop nextchat || true
docker rm nextchat || true

# Clean build
docker build --no-cache -t nextchat-custom .

# Run updated container
docker run -d --name nextchat \
  -e OPENAI_API_KEY="$1" \
  -e GOOGLE_API_KEY="$2" \
  -e CODE="$3" \
  -p 3000:3000 \
  nextchat-custom

# Restart nginx
sudo systemctl restart nginx
